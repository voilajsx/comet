const w="modulepreload",p=function(d){return"/"+d},h={},y=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){let l=function(s){return Promise.all(s.map(u=>Promise.resolve(u).then(c=>({status:"fulfilled",value:c}),c=>({status:"rejected",reason:c}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),f=o?.nonce||o?.getAttribute("nonce");i=l(t.map(s=>{if(s=p(s),s in h)return;h[s]=!0;const u=s.endsWith(".css"),c=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${c}`))return;const n=document.createElement("link");if(n.rel=u?"stylesheet":w,u||(n.as="script"),n.crossOrigin="",n.href=s,f&&n.setAttribute("nonce",f),document.head.appendChild(n),u)return new Promise((g,m)=>{n.addEventListener("load",g),n.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${s}`)))})}))}function a(l){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=l,window.dispatchEvent(o),!o.defaultPrevented)throw l}return i.then(l=>{for(const o of l||[])o.status==="rejected"&&a(o.reason);return e().catch(a)})},v=(()=>{if(typeof browser<"u")return browser;if(typeof chrome<"u")return chrome;throw new Error("No browser extension API available")})();class z{constructor(){this.api=v,this.defaults={},this.defaultsLoaded=!1,this.isInitialized=!1,this.initialize()}async initialize(){if(!this.isInitialized)try{await this.loadDefaults(),await this.initializeDefaults(),this.isInitialized=!0,console.log("[Comet Storage] Initialized with defaults")}catch{console.warn("[Comet Storage] No defaults found, continuing without defaults"),this.defaults={},this.defaultsLoaded=!0,this.isInitialized=!0}}async loadDefaults(){if(!this.defaultsLoaded)try{const e=await y(()=>import("./defaults-pbQvd1qC.js"),[]);this.defaults=e.default||{},this.defaultsLoaded=!0,console.log("[Comet Storage] Loaded defaults from defaults.json")}catch{this.defaults={},this.defaultsLoaded=!0}}async initializeDefaults(){try{if((await this.api.storage.local.get("_defaultsInitialized"))._defaultsInitialized)return;if(Object.keys(this.defaults).length>0){for(const[t,r]of Object.entries(this.defaults))(await this.api.storage.sync.get(t))[t]===void 0&&await this.api.storage.sync.set({[t]:r});console.log("[Comet Storage] Initialized with defaults")}await this.api.storage.local.set({_defaultsInitialized:!0})}catch(e){console.warn("[Comet Storage] Failed to initialize defaults:",e)}}async get(e,t=void 0){try{if(await this.initialize(),typeof e=="string"){const r=await this.api.storage.sync.get(e);return r[e]!==void 0?r[e]:this.defaults[e]!==void 0?this.defaults[e]:t}if(Array.isArray(e)){const r=await this.api.storage.sync.get(e),i={};for(const a of e)r[a]!==void 0?i[a]=r[a]:this.defaults[a]!==void 0?i[a]=this.defaults[a]:i[a]=void 0;return i}if(e===null){const r=await this.api.storage.sync.get(null),i={...this.defaults};return Object.assign(i,r),delete i._defaultsInitialized,i}return t}catch(r){throw console.error("[Comet Storage] Get operation failed:",r),new Error("Failed to read from storage: "+r.message)}}async set(e,t=void 0){try{return await this.initialize(),typeof e=="string"?(await this.api.storage.sync.set({[e]:t}),!0):typeof e=="object"&&e!==null?(await this.api.storage.sync.set(e),!0):!1}catch(r){throw console.error("[Comet Storage] Set operation failed:",r),new Error("Failed to write to storage: "+r.message)}}async remove(e){try{return await this.api.storage.sync.remove(e),!0}catch(t){throw console.error("[Comet Storage] Remove operation failed:",t),new Error("Failed to remove from storage: "+t.message)}}async clear(){try{return await this.api.storage.sync.clear(),await this.api.storage.local.clear(),!0}catch(e){throw console.error("[Comet Storage] Clear operation failed:",e),new Error("Failed to clear storage: "+e.message)}}async has(e){try{return await this.get(e)!==void 0}catch{return!1}}onChange(e){const t=(r,i)=>{e(r,i)};return this.api.storage.onChanged.addListener(t),()=>{this.api.storage.onChanged.removeListener(t)}}getDefaults(){return JSON.parse(JSON.stringify(this.defaults))}}const S=new z;export{S as s};
//# sourceMappingURL=storage-CjHHMo7h.js.map
