import{b as V,r as s,C as p}from"./index-BkgtWSli.js";import{s as r}from"./storage-CVg25cfU.js";import{c as C}from"./api-u9XC6Ash.js";/**
 * @license lucide-react v0.516.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],T=V("chart-column",E);function P(){const[m,f]=s.useState(null),[h,w]=s.useState(null),[i,d]=s.useState({autoValidate:!1,saveHistory:!1}),[c,l]=s.useState([]),[v,n]=s.useState({analyze:!1,validate:!1});s.useEffect(()=>{z()},[]);const z=async()=>{try{const a=await r.get("pageAnalyzer.autoValidate",!1),t=await r.get("pageAnalyzer.saveHistory",!1),e=await r.get("pageAnalyzer.history",[]);d({autoValidate:a,saveHistory:t}),l(e)}catch(a){console.error("Failed to load data:",a)}},H=async()=>{n(a=>({...a,analyze:!0}));try{const a=await p.sendToContent({type:"getPageSize",data:{}});if(console.log("pagesize",a.data),a.success){const t={size:a.data.formatted,url:a.data.url,domain:new URL(a.data.url).hostname,timestamp:Date.now()};return f(t),i.saveHistory&&await u("analysis",t),{success:!0,data:t}}else throw new Error(a.error||"Analysis failed")}catch(a){return{success:!1,error:a.message}}finally{n(a=>({...a,analyze:!1}))}},S=async()=>{n(a=>({...a,validate:!0}));try{const a=await p.getActiveTab();if(!a?.url)throw new Error("Cannot get current tab");const t=a.url,e=new URL(t).hostname,o=await C.get(`https://validator.w3.org/nu/?doc=${encodeURIComponent(t)}&out=json`);if(o.ok){const g=(o.data.messages||[]).filter(A=>A.type==="error").length,y={isValid:g===0,errors:g,url:t,domain:e,timestamp:Date.now()};return w(y),i.saveHistory&&await u("validation",y),{success:!0,data:y}}else throw new Error("Validation service unavailable")}catch(a){return{success:!1,error:a.message}}finally{n(a=>({...a,validate:!1}))}},u=async(a,t)=>{try{const o=[{type:a,data:t,timestamp:Date.now()},...c.slice(0,4)];l(o),await r.set("pageAnalyzer.history",o)}catch(e){console.error("Failed to save history:",e)}};return{pageData:m,validationResult:h,settings:i,history:c,analyzePageSize:H,validateHTML:S,updateSetting:async(a,t)=>{d(e=>({...e,[a]:t})),await r.set(`pageAnalyzer.${a}`,t)},clearHistory:async()=>{l([]),await r.remove("pageAnalyzer.history")},loading:v,hasHistory:c.length>0}}export{T as C,P as u};
//# sourceMappingURL=usePageAnalyzer-DY0ld9gc.js.map
