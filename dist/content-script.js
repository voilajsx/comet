(function(){"use strict";function l(){const o=document.documentElement.outerHTML,e=document.body.innerText||"",t=document.images.length,s=document.links.length;return{htmlBytes:new Blob([o]).size,textBytes:new Blob([e]).size,formatted:d(new Blob([o]).size),images:t,links:s,timestamp:Date.now()}}function d(o){if(o===0)return"0 Bytes";const e=1024,t=["Bytes","KB","MB","GB"],s=Math.floor(Math.log(o)/Math.log(e));return parseFloat((o/Math.pow(e,s)).toFixed(1))+" "+t[s]}const m={name:"pageAnalyzer",handlers:{getPageSize:()=>l()},mainAction:()=>l(),init:()=>{console.log("[Page Analyzer] Simple feature initialized - page size only")},meta:{name:"Page Analyzer",description:"Analyzes basic page size information",version:"1.0.0",permissions:[]}},h={async fetch(o,e={}){try{const t=await new Promise((s,n)=>{chrome.runtime.sendMessage({type:"api.fetch",data:{url:o,method:e.method||"GET",headers:e.headers||{},body:e.body||null,timeout:e.timeout||3e4}},r=>{chrome.runtime.lastError?n(new Error(chrome.runtime.lastError.message)):s(r)})});return{ok:t.success,status:t.status,json:()=>Promise.resolve(t.data),data:t.data,error:t.error}}catch(t){return{ok:!1,status:0,error:t.message,json:()=>Promise.reject(t)}}},async get(o,e={}){return this.fetch(o,{method:"GET",headers:e})},async post(o,e=null,t={}){return this.fetch(o,{method:"POST",body:e,headers:t})},async put(o,e=null,t={}){return this.fetch(o,{method:"PUT",body:e,headers:t})},async patch(o,e=null,t={}){return this.fetch(o,{method:"PATCH",body:e,headers:t})},async delete(o,e={}){return this.fetch(o,{method:"DELETE",headers:e})}},g={name:"quoteGenerator",handlers:{getQuote:()=>i(),getMotivationalQuote:()=>y()},mainAction:()=>i(),init:()=>{console.log("[Quote Generator] Feature initialized")},meta:{name:"Quote Generator",description:"Simple inspirational quotes",version:"1.0.0",permissions:[]}};async function i(){try{console.log("[Quote Generator] Fetching quote from API");const o=await h.get("https://api.adviceslip.com/advice");if(o.ok&&o.data?.slip?.advice)return{success:!0,quote:{text:o.data.slip.advice,author:"Anonymous",category:"advice",timestamp:Date.now()}}}catch(o){console.warn("[Quote Generator] API failed:",o)}return{success:!1,error:"API unavailable",fallbackQuote:f()}}async function y(){const o=await i();return o.success?o.quote.category="motivational":o.fallbackQuote=p(),o}function f(){const o=[{text:"The only way to do great work is to love what you do.",author:"Steve Jobs"},{text:"Life is what happens while you're busy making other plans.",author:"John Lennon"},{text:"The future belongs to those who believe in their dreams.",author:"Eleanor Roosevelt"}];return{...o[Math.floor(Math.random()*o.length)],category:"wisdom",source:"fallback",timestamp:Date.now()}}function p(){const o=[{text:"Success is not final, failure is not fatal: it is the courage to continue that counts.",author:"Winston Churchill"},{text:"The only impossible journey is the one you never begin.",author:"Tony Robbins"},{text:"Don't watch the clock; do what it does. Keep going.",author:"Sam Levenson"}];return{...o[Math.floor(Math.random()*o.length)],category:"motivational",source:"fallback",timestamp:Date.now()}}const c=Object.values(Object.freeze(Object.defineProperty({__proto__:null,pageAnalyzer:m,quoteGenerator:g},Symbol.toStringTag,{value:"Module"})));class w{constructor(){this.isInitialized=!1,this.modules=new Map,this.messageHandlers=new Map,this.moduleRegistry=new Map,this.initialize()}async initialize(){if(!this.isInitialized){console.log("[Comet Content] Loading on:",window.location.href);try{this.setupMessageHandling(),this.registerCoreHandlers(),this.loadModules(),this.notifyReady(),this.isInitialized=!0,console.log(`[Comet Content] Initialized with ${this.modules.size} modules:`,Array.from(this.modules.keys()))}catch(e){console.error("[Comet Content] Initialization error:",e),this.isInitialized=!0}}}setupMessageHandling(){try{chrome.runtime.onMessage.addListener((e,t,s)=>(this.handleMessage(e,t,s),!0))}catch(e){console.warn("[Comet Content] Message handling setup failed:",e)}}registerCoreHandlers(){this.registerHandler("ping",()=>({success:!0,ready:!0,url:window.location.href,timestamp:Date.now(),modules:Array.from(this.modules.keys()),moduleCount:this.modules.size})),this.registerHandler("getPageInfo",()=>({url:window.location.href,title:document.title,hostname:window.location.hostname,timestamp:Date.now()})),this.registerHandler("getModules",()=>({modules:Array.from(this.modules.keys()),handlers:Array.from(this.messageHandlers.keys()),moduleCount:this.modules.size})),this.registerHandler("performMainAction",e=>this.performCombinedAction(e))}loadModules(){console.log("[Comet Content] Loading modules...");let e=0;for(const t of c)try{t&&this.isValidModule(t)&&(this.registerModule(t),e++)}catch(s){console.warn("[Comet Content] Failed to register module:",s)}console.log(`[Comet Content] Loaded ${e}/${c.length} modules`)}registerModule(e){try{const t=e.name;if(this.modules.has(t)){console.warn(`[Comet Content] Module "${t}" already registered, skipping`);return}if(this.modules.set(t,e),e.handlers&&Object.entries(e.handlers).forEach(([s,n])=>{if(typeof n=="function"){if(this.messageHandlers.has(s)){const r=this.moduleRegistry.get(s);console.warn(`[Comet Content] Handler "${s}" conflict: Module "${t}" vs existing "${r}", skipping`);return}this.registerHandler(s,n),this.moduleRegistry.set(s,t)}}),typeof e.init=="function")try{e.init()}catch(s){console.warn(`[Comet Content] Module "${t}" init failed:`,s)}console.log(`[Comet Content] Module "${t}" registered successfully`)}catch(t){console.error("[Comet Content] Module registration failed:",t)}}isValidModule(e){return!!(e&&typeof e=="object"&&e.name&&typeof e.name=="string"&&(e.handlers||e.mainAction))}registerHandler(e,t){if(typeof t!="function")throw new Error(`Handler for "${e}" must be a function`);this.messageHandlers.set(e,t)}async handleMessage(e,t,s){try{const{type:n,data:r,id:a}=e;if(!n){s({success:!1,error:"Message type required"});return}console.log(`[Comet Content] Message: ${n}`,r);const u=this.messageHandlers.get(n);if(!u){s({success:!1,error:`No handler for: ${n}`,availableHandlers:Array.from(this.messageHandlers.keys()),moduleCount:this.modules.size});return}const C=await this.executeHandler(u,r,t),b=this.moduleRegistry.get(n);s({success:!0,data:C,module:b,id:a})}catch(n){console.error("[Comet Content] Message handling error:",n),s({success:!1,error:n.message||"Internal error",id:e.id})}}async executeHandler(e,t,s){try{return await e(t,s)}catch(n){throw console.error("[Comet Content] Handler execution error:",n),n}}async performCombinedAction(e){const t={},s={};for(const[n,r]of this.modules)try{typeof r.mainAction=="function"?t[n]=await r.mainAction(e):typeof r.analyze=="function"&&(t[n]=await r.analyze(e))}catch(a){s[n]=a.message,console.warn(`[Comet Content] Module "${n}" failed:`,a)}return{success:Object.keys(s).length===0,message:`Combined action completed across ${Object.keys(t).length} modules`,results:t,errors:Object.keys(s).length>0?s:void 0,timestamp:Date.now(),url:window.location.href}}notifyReady(){try{chrome.runtime.sendMessage({type:"contentScriptReady",data:{url:window.location.href,modules:Array.from(this.modules.keys()),moduleCount:this.modules.size,timestamp:Date.now()}})}catch(e){console.warn("[Comet Content] Failed to notify service worker:",e)}}getInfo(){return{modules:Array.from(this.modules.keys()),handlers:Array.from(this.messageHandlers.keys()),moduleCount:this.modules.size,url:window.location.href,initialized:this.isInitialized}}}const M=new w;typeof globalThis<"u"&&(globalThis.contentScriptManager=M)})();
//# sourceMappingURL=content-script.js.map
