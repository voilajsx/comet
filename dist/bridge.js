(function(){"use strict";function y(){return{wordCount:(document.body.innerText||"").trim().split(/\s+/).filter(t=>t.length>0).length,pageSize:p(),title:document.title,url:window.location.href}}function p(){const s=document.documentElement.outerHTML,e=document.body.innerText||"";return{htmlBytes:new Blob([s]).size,textBytes:new Blob([e]).size,formatted:I(new Blob([s]).size)}}function I(s){if(s===0)return"0 Bytes";const e=1024,t=["Bytes","KB","MB"],r=Math.floor(Math.log(s)/Math.log(e));return parseFloat((s/Math.pow(e,r)).toFixed(1))+" "+t[r]}const P={name:"pageAnalyzer",handlers:{getPageData:()=>y(),getPageSize:()=>p()},mainAction:()=>y(),init:()=>{console.log("[Page Analyzer] Module initialized")}},d={async fetch(s,e={}){try{const t=await new Promise((r,a)=>{chrome.runtime.sendMessage({type:"api.fetch",data:{url:s,method:e.method||"GET",headers:e.headers||{},body:e.body||null,timeout:e.timeout||3e4}},o=>{chrome.runtime.lastError?a(new Error(chrome.runtime.lastError.message)):r(o)})});return{ok:t.success,status:t.status,json:()=>Promise.resolve(t.data),data:t.data,error:t.error}}catch(t){return{ok:!1,status:0,error:t.message,json:()=>Promise.reject(t)}}},async get(s,e={}){return this.fetch(s,{method:"GET",headers:e})},async post(s,e=null,t={}){return this.fetch(s,{method:"POST",body:e,headers:t})},async put(s,e=null,t={}){return this.fetch(s,{method:"PUT",body:e,headers:t})},async patch(s,e=null,t={}){return this.fetch(s,{method:"PATCH",body:e,headers:t})},async delete(s,e={}){return this.fetch(s,{method:"DELETE",headers:e})}},D={name:"quoteGenerator",handlers:{getQuote:()=>m(),getMotivationalQuote:()=>z()},mainAction:()=>m(),init:()=>{console.log("[Quote Generator] Module initialized")}};async function m(){const s=[{url:"https://api.adviceslip.com/advice",transform:e=>({text:e.data.data.slip.advice,author:"Anonymous",tags:["advice"]})},{url:"https://api.kanye.rest/",transform:e=>({text:e.data.data.quote,author:"Kanye West",tags:["inspiration"]})}];for(const e of s)try{console.log(`[Quote Generator] Trying ${e.url}`);const t=await d.get(e.url);if(console.log("[Quote Generator] Full response:",JSON.stringify(t,null,2)),t.ok&&t.data&&t.data.data){const r=e.transform(t);return console.log("[Quote Generator] Transformed quote:",r),{success:!0,quote:{text:r.text,author:r.author,length:r.text.length,tags:r.tags},timestamp:Date.now()}}}catch(t){console.warn("[Quote Generator] API failed:",t);continue}return{success:!1,error:"APIs unavailable",fallbackQuote:x()}}async function z(){const s=await m();return s.success?(s.quote.category="motivational",s):{success:!1,error:s.error,fallbackQuote:E()}}function x(){const s=[{text:"The only way to do great work is to love what you do.",author:"Steve Jobs"},{text:"Life is what happens while you're busy making other plans.",author:"John Lennon"},{text:"The future belongs to those who believe in their dreams.",author:"Eleanor Roosevelt"}];return{...s[Math.floor(Math.random()*s.length)],source:"fallback",tags:["wisdom"]}}function E(){const s=[{text:"Success is courage to continue despite failures.",author:"Winston Churchill"},{text:"The only impossible journey is the one you never begin.",author:"Tony Robbins"},{text:"Don't watch the clock; keep going like it does.",author:"Sam Levenson"}];return{...s[Math.floor(Math.random()*s.length)],category:"motivational",source:"fallback",tags:["motivation"]}}const V="modulepreload",K=function(s){return"/"+s},Y={},$=function(e,t,r){let a=Promise.resolve();function o(n){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=n,window.dispatchEvent(i),!i.defaultPrevented)throw n}return a.then(n=>{for(const i of n||[])i.status==="rejected"&&o(i.reason);return e().catch(o)})},H=(()=>{if(typeof browser<"u")return browser;if(typeof chrome<"u")return chrome;throw new Error("No browser extension API available")})();class L{constructor(){this.api=H,this.syncQuota=this.api.storage.sync.QUOTA_BYTES||102400,this.localQuota=this.api.storage.local.QUOTA_BYTES||10485760,this.syncItemQuota=this.api.storage.sync.QUOTA_BYTES_PER_ITEM||8192,this.defaults={},this.defaultsLoaded=!1,this.isInitialized=!1,this.initialize()}async initialize(){if(!this.isInitialized)try{await this.loadDefaults(),await this.initializeDefaults(),this.isInitialized=!0,console.log("[Comet Storage] Initialized with defaults")}catch(e){console.warn("[Comet Storage] Initialization failed, continuing without defaults:",e),this.defaults={},this.defaultsLoaded=!0,this.isInitialized=!0}}async loadDefaults(){if(!this.defaultsLoaded)try{const e=await $(()=>Promise.resolve().then(()=>J),void 0);this.defaults=e.default||{},this.defaultsLoaded=!0,console.log("[Comet Storage] Loaded defaults from defaults.json")}catch{console.log("[Comet Storage] No defaults.json found, using empty defaults"),this.defaults={},this.defaultsLoaded=!0}}async initializeDefaults(){try{if((await this.api.storage.local.get("_defaultsInitialized"))._defaultsInitialized)return;Object.keys(this.defaults).length>0&&(await this.setDefaults(this.defaults),console.log("[Comet Storage] Initialized storage with defaults")),await this.api.storage.local.set({_defaultsInitialized:!0})}catch(e){console.warn("[Comet Storage] Failed to initialize defaults:",e)}}async setDefaults(e,t=""){for(const[r,a]of Object.entries(e)){const o=t?`${t}.${r}`:r;a&&typeof a=="object"&&!Array.isArray(a)?await this.setDefaults(a,o):await this.getRaw(o)===void 0&&await this.setRaw(o,a)}}async get(e=null,t=void 0,r="auto"){try{if(await this.initialize(),typeof e=="string"){const o=await this.getRaw(e,r);if(o!==void 0)return o;const n=this.getDefaultByPath(e);return n!==void 0?n:t}if(Array.isArray(e)){const o={};for(const n of e)o[n]=await this.get(n,void 0,r);return o}if(e===null){const n=await this.getStorageArea(r,"read").get(null);return this.mergeWithDefaults(n)}const a={};for(const o of Object.keys(e))a[o]=await this.get(o,e[o],r);return a}catch(a){throw console.error("[Comet Storage] Get operation failed:",a),new u("Failed to read from storage",a)}}async set(e,t=void 0,r="auto"){try{if(await this.initialize(),typeof e=="string")return await this.setRaw(e,t,r);const a=[];for(const[o,n]of Object.entries(e))a.push(await this.setRaw(o,n,r));return a.every(o=>o===!0)}catch(a){throw console.error("[Comet Storage] Set operation failed:",a),new u("Failed to write to storage",a)}}async remove(e,t="auto"){try{const r=this.getStorageArea(t,"write");return typeof e=="string"?await r.remove(e):await r.remove(e),!0}catch(r){throw console.error("[Comet Storage] Remove operation failed:",r),new u("Failed to remove from storage",r)}}async clear(e="both"){try{return e==="both"?await Promise.all([this.api.storage.sync.clear(),this.api.storage.local.clear()]):await this.getStorageArea(e,"write").clear(),!0}catch(t){throw console.error("[Comet Storage] Clear operation failed:",t),new u("Failed to clear storage",t)}}async has(e,t="auto"){try{return await this.get(e,void 0,t)!==void 0}catch{return!1}}async getUsage(e="both"){try{const t={};if(e==="both"||e==="sync"){const r=await this.api.storage.sync.getBytesInUse();t.sync={used:r,total:this.syncQuota,percentage:Math.round(r/this.syncQuota*100),available:this.syncQuota-r}}if(e==="both"||e==="local"){const r=await this.api.storage.local.getBytesInUse();t.local={used:r,total:this.localQuota,percentage:Math.round(r/this.localQuota*100),available:this.localQuota-r}}return t}catch(t){return console.error("[Comet Storage] Usage check failed:",t),{sync:{used:0,total:0,percentage:0,available:0}}}}onChange(e){const t=(r,a)=>{e(r,a)};return this.api.storage.onChanged.addListener(t),()=>{this.api.storage.onChanged.removeListener(t)}}async resetToDefaults(){try{return await this.clear(),await this.api.storage.local.remove("_defaultsInitialized"),await this.initializeDefaults(),console.log("[Comet Storage] Reset to defaults"),!0}catch(e){return console.error("[Comet Storage] Reset failed:",e),!1}}getDefaults(){return JSON.parse(JSON.stringify(this.defaults))}async getRaw(e,t="auto"){return(await this.getStorageArea(t,"read").get(e))[e]}async setRaw(e,t,r="auto"){const a={[e]:t},o=this.getStorageArea(r,"write",a);return this.validateDataSize(a,o),await o.set(a),!0}getDefaultByPath(e){return e.split(".").reduce((t,r)=>t?.[r],this.defaults)}mergeWithDefaults(e){const t=JSON.parse(JSON.stringify(this.defaults));for(const[r,a]of Object.entries(e))r!=="_defaultsInitialized"&&this.setByPath(t,r,a);return t}setByPath(e,t,r){const a=t.split("."),o=a.pop(),n=a.reduce((i,g)=>(g in i||(i[g]={}),i[g]),e);n[o]=r}getStorageArea(e,t,r=null){if(e==="sync")return this.api.storage.sync;if(e==="local")return this.api.storage.local;if(e==="auto"){if(t==="read")return this.api.storage.sync;if(r)return this.calculateDataSize(r)>this.syncItemQuota?this.api.storage.local:this.api.storage.sync}return this.api.storage.sync}calculateDataSize(e){try{return new Blob([JSON.stringify(e)]).size}catch{return JSON.stringify(e).length}}validateDataSize(e,t){const r=this.calculateDataSize(e);if(t===this.api.storage.sync){for(const[o,n]of Object.entries(e)){const i=this.calculateDataSize({[o]:n});if(i>this.syncItemQuota)throw new u(`Item "${o}" exceeds sync storage item limit (${i} > ${this.syncItemQuota} bytes)`)}if(r>this.syncQuota)throw new u(`Data exceeds sync storage quota (${r} > ${this.syncQuota} bytes)`)}else if(r>this.localQuota)throw new u(`Data exceeds local storage quota (${r} > ${this.localQuota} bytes)`)}}class u extends Error{constructor(e,t){super(e),this.name="CometStorageError",this.originalError=t}}const l=new L,U={name:"userAuth",handlers:{login:s=>O(s),logout:()=>q(),getProfile:()=>R(),getAuthStatus:s=>w(s)},mainAction:s=>w(s),init:()=>{console.log("[User Auth] Module initialized with 7-day sessions")}};async function O(s){try{const{email:e,password:t}=s||{};if(!e||!t)return{success:!1,error:"Email and password required"};console.log("[User Auth] Attempting login with:",{email:e});const r=await d.post("https://reqres.in/api/login",{email:e,password:t},{"x-api-key":"reqres-free-v1"});return console.log("[User Auth] Full response:",JSON.stringify(r,null,2)),r.ok&&r.data&&r.data.data&&r.data.data.token?(await F(r.data.data.token),{success:!0,message:"Login successful",user:{email:e,token:r.data.data.token,loginTime:Date.now()}}):{success:!1,error:r.data?.data?.error||r.data?.error||r.error||`HTTP ${r.data?.status}`}}catch(e){return console.error("[User Auth] Login failed:",e),{success:!1,error:"Login request failed",details:e.message}}}async function q(){try{return await l.remove(["auth.token","auth.timestamp","auth.userData","auth.userCacheTime","auth.userEmail"]),console.log("[User Auth] User logged out successfully"),{success:!0,message:"Logged out successfully",timestamp:Date.now()}}catch(s){return console.error("[User Auth] Logout failed:",s),{success:!1,error:"Logout failed",details:s.message}}}async function R(){try{const s=await b();if(!s)return{success:!1,error:"No authentication token found",needsLogin:!0};const e=await Q();if(e)return{success:!0,profile:e};const t=await d.get("https://reqres.in/api/users/2",{Authorization:`Bearer ${s}`,"x-api-key":"reqres-free-v1"});if(t.ok&&t.data&&t.data.data){const r=t.data.data,a={id:r.id,email:r.email,firstName:r.first_name,lastName:r.last_name,name:`${r.first_name} ${r.last_name}`,avatar:r.avatar,lastAccess:Date.now()};return await N(a),{success:!0,profile:a}}else return{success:!1,error:"Failed to fetch profile",needsLogin:!0}}catch(s){return console.error("[User Auth] Profile fetch failed:",s),{success:!1,error:"Profile request failed",details:s.message}}}async function w(s={}){try{const e=s.sessionDays||await l.get("auth.sessionDays",7);return await b(e)?{success:!0,authenticated:!0,hasToken:!0,message:"User is authenticated",sessionDays:e,timestamp:Date.now()}:{success:!0,authenticated:!1,message:"No valid token found",sessionDays:e,timestamp:Date.now()}}catch(e){return console.error("[User Auth] Auth status check failed:",e),{success:!1,authenticated:!1,error:e.message}}}async function F(s){try{await l.set({"auth.token":s,"auth.timestamp":Date.now()}),console.log("[User Auth] Token stored successfully")}catch(e){console.error("[User Auth] Failed to store token:",e)}}async function b(s=7){try{const e=await l.get("auth.token"),t=await l.get("auth.timestamp");if(!e||!t)return null;const r=Date.now()-t,a=s*24*60*60*1e3;return r<a?e:(console.log(`[User Auth] Token expired after ${s} days, removing`),await l.remove(["auth.token","auth.timestamp","auth.userData","auth.userCacheTime","auth.userEmail"]),null)}catch(e){return console.error("[User Auth] Failed to get token:",e),null}}async function N(s){try{await l.set({"auth.userData":s,"auth.userCacheTime":Date.now()})}catch(e){console.error("[User Auth] Failed to cache user data:",e)}}async function Q(){try{const s=await l.get("auth.userData"),e=await l.get("auth.userCacheTime");if(!s||!e)return null;const t=Date.now()-e,r=60*60*1e3;return t<r?s:null}catch(s){return console.error("[User Auth] Failed to get cached user data:",s),null}}const j=(()=>{if(typeof browser<"u")return browser;if(typeof chrome<"u")return chrome;throw new Error("No browser extension API available")})();class _{constructor(){this.api=j,this.messageId=0,this.pendingMessages=new Map,this.messageTimeout=3e4,this.retryAttempts=3,this.retryDelay=1e3}async sendToBackground(e,t={}){try{const r=this.createMessage(e),a=t.timeout||this.messageTimeout,o=t.retries||this.retryAttempts;return await this.retryOperation(()=>this.sendRuntimeMessage(r,a),o,"background script")}catch(r){throw console.error("[Comet Messaging] Background message failed:",r),new h("Failed to communicate with background script",r)}}async sendToContent(e,t=null,r={}){try{const a=t||await this.getActiveTabId(),o=this.createMessage(e),n=r.timeout||this.messageTimeout,i=r.retries||this.retryAttempts;if(!a)throw new Error("No active tab found");return await this.retryOperation(()=>this.sendTabMessage(a,o,n),i,`content script (tab ${a})`)}catch(a){throw console.error("[Comet Messaging] Content script message failed:",a),new h("Failed to communicate with content script",a)}}async sendToTab(e,t,r={}){try{const a=this.createMessage(t),o=r.timeout||this.messageTimeout,n=r.retries||this.retryAttempts;return await this.retryOperation(()=>this.sendTabMessage(e,a,o),n,`tab ${e}`)}catch(a){throw console.error("[Comet Messaging] Tab message failed:",a),new h(`Failed to communicate with tab ${e}`,a)}}async broadcast(e,t={}){try{const r=await this.api.tabs.query({}),a=this.createMessage(e),o=[];for(const n of r)try{const i=await this.sendToTab(n.id,a,{...t,retries:1});o.push({tabId:n.id,url:n.url,success:!0,response:i})}catch(i){o.push({tabId:n.id,url:n.url,success:!1,error:i.message})}return o}catch(r){throw console.error("[Comet Messaging] Broadcast failed:",r),new h("Failed to broadcast message",r)}}onMessage(e){const t=(r,a,o)=>{try{const n=e(r,a);if(n instanceof Promise)return n.then(i=>o(i)).catch(i=>o({success:!1,error:i.message})),!0;n!==void 0&&o(n)}catch(n){console.error("[Comet Messaging] Message handler error:",n),o({success:!1,error:n.message})}};return this.api.runtime.onMessage.addListener(t),()=>{this.api.runtime.onMessage.removeListener(t)}}onMessageType(e,t){return this.onMessage((r,a)=>{if(r.type===e)return t(r.data,a)})}async getActiveTab(){try{const[e]=await this.api.tabs.query({active:!0,currentWindow:!0});return e||null}catch(e){return console.error("[Comet Messaging] Failed to get active tab:",e),null}}async getActiveTabId(){return(await this.getActiveTab())?.id||null}isTabSupported(e){const t=typeof e=="string"?e:e?.url;return t?!["chrome://","chrome-extension://","moz-extension://","about:","file://","ftp://","data:","blob:"].some(a=>t.startsWith(a)):!1}createMessage(e){return{id:++this.messageId,timestamp:Date.now(),...e}}async sendRuntimeMessage(e,t){return new Promise((r,a)=>{const o=setTimeout(()=>{a(new Error("Message timeout"))},t);this.api.runtime.sendMessage(e,n=>{if(clearTimeout(o),this.api.runtime.lastError){a(new Error(this.api.runtime.lastError.message));return}r(n||{success:!1,error:"No response"})})})}async sendTabMessage(e,t,r){return new Promise((a,o)=>{const n=setTimeout(()=>{o(new Error("Message timeout"))},r);this.api.tabs.sendMessage(e,t,i=>{if(clearTimeout(n),this.api.runtime.lastError){o(new Error(this.api.runtime.lastError.message));return}a(i||{success:!1,error:"No response"})})})}async retryOperation(e,t,r){let a;for(let o=0;o<=t;o++)try{return await e()}catch(n){if(a=n,o===t)break;const i=this.retryDelay*Math.pow(2,o);console.warn(`[Comet Messaging] Retry ${o+1}/${t} for ${r} after ${i}ms:`,n.message),await this.sleep(i)}throw a}sleep(e){return new Promise(t=>setTimeout(t,e))}setTimeout(e){this.messageTimeout=e}setRetryConfig(e,t){this.retryAttempts=e,this.retryDelay=t}}class h extends Error{constructor(e,t){super(e),this.name="CometMessagingError",this.originalError=t}}const c=new _,T=[P,D,U,{name:"tester",handlers:{testBadge:async()=>(await c.sendToBackground({type:"badge.setText",data:{text:"5"}}),{success:!0,message:'Badge set to "5"'}),testBadgeColor:async()=>(await c.sendToBackground({type:"badge.setColor",data:{color:"#FF0000"}}),{success:!0,message:"Badge color set to red"}),clearBadge:async()=>(await c.sendToBackground({type:"badge.setText",data:{text:""}}),{success:!0,message:"Badge cleared"}),openNewTab:async s=>{try{const e=s?.url||"https://google.com";console.log("[Tester] Opening new tab:",e);const t=await c.sendToBackground({type:"tabs.create",data:{url:e,active:!1}});return console.log("[Tester] Tab creation response:",t),t.success&&t.data?.tab?{success:!0,message:`Opened new tab: ${e}`,tab:t.data.tab}:{success:!1,error:t.error||"Tab creation failed"}}catch(e){return console.error("[Tester] Tab creation error:",e),{success:!1,error:e.message}}},getCurrentTab:async()=>{try{console.log("[Tester] Getting current tab");const s=await c.sendToBackground({type:"tabs.getCurrent",data:{}});if(console.log("[Tester] Current tab response:",s),s.success&&s.data){const e=s.data;return{success:!0,tab:{id:e.id,title:e.title,url:e.url,active:e.active,windowId:e.windowId}}}else return{success:!1,error:s.error||"No current tab found"}}catch(s){return console.error("[Tester] Get current tab error:",s),{success:!1,error:s.message}}},getAllTabs:async()=>{try{console.log("[Tester] Getting all tabs");const s=await c.sendToBackground({type:"tabs.query",data:{}});if(console.log("[Tester] All tabs response:",s),s.success&&Array.isArray(s.data)){const e=s.data;return{success:!0,tabCount:e.length,tabs:e.map(t=>({id:t.id,title:t.title||"No title",url:t.url||"No URL",active:t.active,windowId:t.windowId}))}}else return{success:!1,error:s.error||"Failed to get tabs"}}catch(s){return console.error("[Tester] Get all tabs error:",s),{success:!1,error:s.message}}},closeTab:async s=>{try{const e=s?.tabId;if(!e)return{success:!1,error:"Tab ID required"};const t=await c.sendToBackground({type:"tabs.remove",data:{tabId:e}});return t.success?{success:!0,message:`Closed tab ${e}`}:{success:!1,error:t.error||"Tab close failed"}}catch(e){return console.error("[Tester] Close tab error:",e),{success:!1,error:e.message}}},duplicateCurrentTab:async()=>{try{const s=await c.sendToBackground({type:"tabs.getCurrent",data:{}});if(!s.success||!s.data)return{success:!1,error:"Could not get current tab"};const e=s.data,t=await c.sendToBackground({type:"tabs.duplicate",data:{tabId:e.id}});return t.success&&t.data?.tab?{success:!0,message:"Current tab duplicated",duplicatedTab:t.data.tab}:{success:!1,error:t.error||"Tab duplication failed"}}catch(s){return console.error("[Tester] Duplicate tab error:",s),{success:!1,error:s.message}}},reloadCurrentTab:async s=>{try{const e=await c.sendToBackground({type:"tabs.getCurrent",data:{}});if(!e.success||!e.data)return{success:!1,error:"Could not get current tab"};const t=e.data,r=await c.sendToBackground({type:"tabs.reload",data:{tabId:t.id,bypassCache:s?.bypassCache||!1}});return r.success?{success:!0,message:`Reloaded current tab${s?.bypassCache?" (bypassed cache)":""}`}:{success:!1,error:r.error||"Tab reload failed"}}catch(e){return console.error("[Tester] Reload tab error:",e),{success:!1,error:e.message}}},testStorage:async s=>{const e=s?.key||"test.demo",t=s?.value||`Test at ${new Date().toLocaleTimeString()}`;await l.set(e,t);const r=await l.get(e);return{success:!0,stored:{key:e,value:t},retrieved:r}},getStorageUsage:async()=>({success:!0,usage:await l.getUsage()}),clearTestStorage:async()=>(await l.remove(["test.demo","test.key","test.comprehensive"]),{success:!0,message:"Test storage cleared"}),testApiGet:async()=>{try{const s=await d.get("https://jsonplaceholder.typicode.com/posts/1");return{success:!0,message:"API GET successful",data:{id:s.data.id,title:s.data.title,body:s.data.body.slice(0,50)+"..."}}}catch(s){return{success:!1,error:"API GET failed: "+s.message}}},testApiPost:async()=>{try{const s=await d.post("https://jsonplaceholder.typicode.com/posts",{title:"Test Post from Comet",body:"This is a test post",userId:1});return{success:!0,message:"API POST successful",data:{id:s.data.id,title:s.data.title}}}catch(s){return{success:!1,error:"API POST failed: "+s.message}}},getDetailedPageInfo:async()=>({success:!0,pageInfo:{title:document.title,url:window.location.href,domain:window.location.hostname,wordCount:document.body.innerText.split(" ").length,linkCount:document.links.length,imageCount:document.images.length,lastModified:document.lastModified,characterCount:document.body.innerText.length,scriptCount:document.scripts.length,stylesheetCount:document.styleSheets.length,metaTags:Array.from(document.querySelectorAll("meta")).length,headings:{h1:document.querySelectorAll("h1").length,h2:document.querySelectorAll("h2").length,h3:document.querySelectorAll("h3").length}}}),findElement:async s=>{const e=s?.selector||"h1",t=document.querySelector(e);return t?{success:!0,found:!0,element:{tagName:t.tagName,textContent:t.textContent.slice(0,100),id:t.id||"no-id",className:t.className||"no-class"}}:{success:!0,found:!1,message:`Element "${e}" not found`}},highlightElements:async s=>{const e=s?.selector||"h1, h2, h3",t=document.querySelectorAll(e);return t.forEach(r=>{r.style.backgroundColor="yellow",r.style.border="2px solid red"}),{success:!0,highlighted:t.length,selector:e}},removeHighlight:async()=>{const s=document.querySelectorAll('*[style*="background-color: yellow"]');return s.forEach(e=>{e.style.backgroundColor="",e.style.border=""}),{success:!0,removed:s.length,message:"Highlights removed"}},testEcho:async s=>({success:!0,echo:s,timestamp:Date.now(),message:"Echo test successful"}),testBroadcast:async()=>{const s=await c.broadcast({type:"testMessage",data:{from:"tester",message:"Broadcast test",timestamp:Date.now()}}),e=s.filter(t=>t.success).length;return{success:!0,message:`Broadcast sent to ${s.length} tabs`,successful:e,total:s.length}},testDownload:async()=>{const s={extensionName:"Comet Tester",timestamp:new Date().toISOString(),testResults:{badge:"working",storage:"working",messaging:"working"}};return await c.sendToBackground({type:"downloads.downloadData",data:{data:JSON.stringify(s,null,2),filename:"comet-test-export.json",mimeType:"application/json"}}),{success:!0,message:"Test data downloaded as JSON file"}},bookmarkCurrentPage:async()=>(await c.sendToBackground({type:"bookmarks.create",data:{title:`Test Bookmark - ${document.title}`,url:window.location.href}}),{success:!0,message:"Current page bookmarked",page:document.title}),createContextMenu:async()=>(await c.sendToBackground({type:"contextMenu.create",data:{id:"comet-test",title:"Test Comet Extension",contexts:["page","selection"]}}),{success:!0,message:"Context menu created (right-click page to see)"}),removeContextMenu:async()=>(await c.sendToBackground({type:"contextMenu.remove",data:{id:"comet-test"}}),{success:!0,message:"Context menu removed"}),runAllTests:async()=>{const s={};try{await l.set("test.comprehensive","test-value");const e=await l.get("test.comprehensive");s.storage=e==="test-value"?"PASS":"FAIL";const t=await d.get("https://jsonplaceholder.typicode.com/posts/1");s.api=t.ok?"PASS":"FAIL",s.pageAccess=document.title?"PASS":"FAIL",await c.sendToBackground({type:"badge.setText",data:{text:"✓"}}),s.badge="PASS";const r=await c.sendToBackground({type:"tabs.query",data:{active:!0}});s.tabManagement=r.success?"PASS":"FAIL";const a=await c.sendToBackground({type:"tabs.create",data:{url:"https://example.com",active:!1}});s.tabCreation=a.success?"PASS":"FAIL",a.success&&a.data?.tab?.id&&setTimeout(async()=>{try{await c.sendToBackground({type:"tabs.remove",data:{tabId:a.data.tab.id}})}catch(n){console.warn("Failed to close test tab:",n)}},2e3);const o=await c.sendToBackground({type:"ping"});s.coreMessaging=o.success?"PASS":"FAIL"}catch(e){s.error=e.message}return{success:!0,testResults:s,summary:`${Object.values(s).filter(e=>e==="PASS").length} tests passed`}},debugHandlers:async()=>(typeof globalThis<"u"&&globalThis.debugHandlers&&globalThis.debugHandlers(),{success:!0,message:"Check console for handler information",availableHandlers:Array.from(globalThis.scriptBridge?.messageHandlers?.keys()||[])}),checkPermissions:async()=>{try{const s=await new Promise(a=>{chrome.permissions.contains({permissions:["tabs"]},a)}),e=await new Promise(a=>{chrome.permissions.contains({origins:["<all_urls>"]},a)}),t=await new Promise(a=>{chrome.permissions.contains({permissions:["bookmarks"]},a)}),r=await new Promise(a=>{chrome.permissions.contains({permissions:["downloads"]},a)});return{success:!0,permissions:{tabs:s,hostPermissions:e,bookmarks:t,downloads:r},message:"Permissions check complete"}}catch(s){return{success:!1,error:"Permission check failed: "+s.message}}},getCurrentWindow:async()=>{try{const s=await c.sendToBackground({type:"windows.getCurrent",data:{}});return s.success?{success:!0,window:s.data}:{success:!1,error:s.error||"Failed to get current window"}}catch(s){return{success:!1,error:s.message}}},getExtensionInfo:async()=>{try{const s=await c.sendToBackground({type:"extension.getInfo",data:{}});return s.success?{success:!0,extensionInfo:s.data}:{success:!1,error:s.error||"Failed to get extension info"}}catch(s){return{success:!1,error:s.message}}}},init:()=>{console.log("[Tester] Complete platform tester initialized (tabs API fixed)")}}];class G{constructor(){this.isInitialized=!1,this.modules=new Map,this.messageHandlers=new Map,this.moduleRegistry=new Map,this.moduleLoadStrategy="static-imports",this.coreHandlers=new Set,this.initialize()}async initialize(){if(!this.isInitialized){console.log("[Comet Bridge] Universal bridge loading on:",window.location.href);try{this.setupMessageHandling(),this.registerCoreHandlers(),this.loadStaticModules(),this.notifyReady(),this.isInitialized=!0,console.log(`[Comet Bridge] Initialized with ${this.modules.size} modules:`,Array.from(this.modules.keys()))}catch(e){console.error("[Comet Bridge] Initialization error:",e),this.isInitialized=!0}}}setupMessageHandling(){try{chrome.runtime.onMessage.addListener((e,t,r)=>(this.handleMessage(e,t,r),!0))}catch(e){console.warn("[Comet Bridge] Message handling setup failed:",e)}}registerCoreHandlers(){this.registerCoreHandler("ping",()=>({success:!0,ready:!0,url:window.location.href,timestamp:Date.now(),modules:Array.from(this.modules.keys()),moduleCount:this.modules.size,loadStrategy:this.moduleLoadStrategy})),this.registerCoreHandler("getPageInfo",()=>({url:window.location.href,title:document.title,hostname:window.location.hostname,timestamp:Date.now()})),this.registerCoreHandler("getModules",()=>({modules:Array.from(this.modules.keys()),handlers:Array.from(this.messageHandlers.keys()),moduleCount:this.modules.size})),this.registerCoreHandler("performMainAction",e=>this.performCombinedAction(e))}registerCoreHandler(e,t){if(typeof t!="function")throw new Error(`Core handler for "${e}" must be a function`);this.coreHandlers.add(e),this.messageHandlers.set(e,t),this.moduleRegistry.set(e,"core"),console.log(`[Comet Bridge] Core handler "${e}" registered`)}loadStaticModules(){console.log("[Comet Bridge] Loading static modules...");let e=0;for(const t of T)try{t&&(this.registerModule(t),e++)}catch(r){console.warn("[Comet Bridge] Failed to register module:",r)}console.log(`[Comet Bridge] Loaded ${e}/${T.length} modules`)}registerModule(e){try{if(!this.isValidModule(e))throw new Error("Invalid module configuration");const t=e.name;if(this.modules.has(t)){console.warn(`[Comet Bridge] Module "${t}" already registered, skipping`);return}if(this.modules.set(t,e),e.handlers&&Object.entries(e.handlers).forEach(([r,a])=>{if(typeof a=="function"){if(this.coreHandlers.has(r)){console.warn(`[Comet Bridge] Module "${t}" tried to register core handler "${r}", skipping`);return}if(this.messageHandlers.has(r)){const o=this.moduleRegistry.get(r);console.warn(`[Comet Bridge] Handler "${r}" conflict: Module "${t}" vs existing "${o}", skipping`);return}this.registerHandler(r,a),this.moduleRegistry.set(r,t)}}),typeof e.init=="function")try{e.init()}catch(r){console.warn(`[Comet Bridge] Module "${t}" init failed:`,r)}console.log(`[Comet Bridge] Module "${t}" registered successfully`)}catch(t){throw console.error("[Comet Bridge] Module registration failed:",t),t}}isValidModule(e){return!!(e&&typeof e=="object"&&e.name&&typeof e.name=="string"&&(e.handlers||e.mainAction))}registerHandler(e,t){if(typeof t!="function")throw new Error(`Handler for "${e}" must be a function`);this.messageHandlers.set(e,t)}async handleMessage(e,t,r){try{const{type:a,data:o,id:n}=e;if(!a){r({success:!1,error:"Message type required"});return}console.log(`[Comet Bridge] Message: ${a}`,o);const i=this.messageHandlers.get(a);if(!i){r({success:!1,error:`No handler for: ${a}`,availableHandlers:Array.from(this.messageHandlers.keys()),moduleCount:this.modules.size,loadStrategy:this.moduleLoadStrategy});return}const g=await this.executeHandler(i,o,t),f=this.moduleRegistry.get(a);r({success:!0,data:g,module:f,id:n})}catch(a){console.error("[Comet Bridge] Message handling error:",a),r({success:!1,error:a.message||"Internal error",id:e.id})}}async executeHandler(e,t,r){try{return await e(t,r)}catch(a){throw console.error("[Comet Bridge] Handler execution error:",a),a}}async performCombinedAction(e){const t={},r={};for(const[a,o]of this.modules)try{o.mainAction&&typeof o.mainAction=="function"?t[a]=await o.mainAction(e):o.analyze&&typeof o.analyze=="function"&&(t[a]=await o.analyze(e))}catch(n){r[a]=n.message,console.warn(`[Comet Bridge] Module "${a}" failed:`,n)}return{success:Object.keys(r).length===0,message:`Combined action completed across ${Object.keys(t).length} modules`,results:t,errors:Object.keys(r).length>0?r:void 0,timestamp:Date.now(),url:window.location.href,loadStrategy:this.moduleLoadStrategy}}notifyReady(){try{chrome.runtime.sendMessage({type:"contentScriptReady",data:{url:window.location.href,modules:Array.from(this.modules.keys()),moduleCount:this.modules.size,timestamp:Date.now(),loadStrategy:this.moduleLoadStrategy}})}catch(e){console.warn("[Comet Bridge] Failed to notify background:",e)}}getHandlerInfo(){const e={totalHandlers:this.messageHandlers.size,coreHandlers:Array.from(this.coreHandlers),moduleHandlers:{},allHandlers:Array.from(this.messageHandlers.keys())};for(const[t,r]of this.moduleRegistry)e.moduleHandlers[r]||(e.moduleHandlers[r]=[]),e.moduleHandlers[r].push(t);return e}}const k=new G;typeof globalThis<"u"&&(globalThis.scriptBridge=k,globalThis.debugHandlers=()=>{console.table(k.getHandlerInfo())});const A={name:"Comet Extension",theme:"metro",variant:"light"},C={module:"userAuth",autoLogin:!0,sessionDays:7,rememberLogin:!0},S={auth:!0,notifications:!0},v={size:"lg",animations:!0},M=!0,J=Object.freeze(Object.defineProperty({__proto__:null,app:A,auth:C,default:{app:A,auth:C,features:S,ui:v,extensionEnabled:M},extensionEnabled:M,features:S,ui:v},Symbol.toStringTag,{value:"Module"}))})();
//# sourceMappingURL=bridge.js.map
